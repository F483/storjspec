// syntax guide: http://www.graphviz.org/pdf/dotguide.pdf
// compile: `dot -Tpdf dependencies.dot -o dependencies.pdf`


digraph G {

    // STORJNET
    subgraph cluster_1 {
        label = "Storjnet";
        node [style=filled,color=white];
        style=filled;
        color=lightblue;

        "Pub/Sub"; // enable publishing and subscribing to events
        "Data streams"; // full duplex data transfer
        "Messaging"; // to shortcut the pubsub after peer found
        "RPC"; // rpc calls and data transfer between clients
        "E2EE"; // End-to-end encryption
        "Bandwidth limiter";
        "REST (SIP 002)"; // put/get shards
    };
    "Pub/Sub" -> "RPC";
    "Messaging" -> "RPC";
    "Data streams" -> "RPC";
    "RPC" -> "Bandwidth limiter";
    "REST (SIP 002)" -> "Bandwidth limiter";
    "Bandwidth limiter" -> "E2EE";
    "E2EE" -> "Crypto";
    "E2EE" -> "Transport";
    "Bandwidth limiter" -> "Database";

    // STORJ PROTOCOL
    subgraph cluster_2 {
        label = "Storj Protocol";
        node [style=filled,color=white];
        style=filled;
        color=lightgoldenrod;

        "Contract"; // terms of a storage contract between peers
        "Audit"; // track state of a contract over time
    };
    "Audit" -> "Contract"; // when/how to perform the audit
    "Audit" -> "Store manager"; // perform audit challange
    "Audit" -> "Ledger (SIP 001)"; // save result in ledger

    // STORJNODE
    subgraph cluster_3 {
        label = "Storjnode";
        node [style=filled,color=white];
        style=filled;
        color=lightseagreen;

        "Roy"; // for sending/receiving of funds for services used 
        "Store manager"; // store data on drives
        "Wallet";
        "Contract manager"; // Store contracts
        "CHISQRDTEST (SIP 003)";
        "Graylist (SIP 004)";
        "Ledger (SIP 001)"; // read/write historic events
    };
    "Roy" -> "Contract manager";
    "Contract manager" -> "Database";
    "Store manager" -> "File system";
    "Store manager" -> "Graylist (SIP 004)";
    "Store manager" -> "Database";
    "Graylist (SIP 004)" -> "CHISQRDTEST (SIP 003)";
    "CHISQRDTEST (SIP 003)" -> "Data streams";
    "CHISQRDTEST (SIP 003)" -> "REST (SIP 002)";
    "Wallet" -> "Blockchain";
    "Roy" -> "Messaging";
    "Roy" -> "Audit"; // perform audits
    "Roy" -> "Contract"; // verify agreed to use/provide a service
    "Roy" -> "Ledger (SIP 001)"; // verify service was used/provided
    "Roy" -> "Wallet"; // transfer funds
    "Roy" -> "Pub/Sub"; // ask/bid on contracts
    "Roy" -> "Store manager";
    "Ledger (SIP 001)" -> "Blockchain";

    // EXTERNAL
    "File system";
    "Crypto"; // for encryption/signing
    "Database";
    "Blockchain";
    "Transport";

}
